[% INCLUDE 'header.html', title => loc('Reporting a problem') %]

[% map_html %]

<h1>[% loc('Reporting a problem') %]</h1>

[%
    IF report.used_map;
        loc('You have located the problem at the point marked with a purple pin on the map. If this is not the correct location, simply click on the map again. ');
    END;
%]

[% IF area_ids_to_list.size == 0 %]
    [% INCLUDE 'reports/new/no_councils_text.html' %]
[% ELSIF area_ids_to_list.size == all_councils.size %]
    [% INCLUDE 'reports/new/all_councils_text.html' %]
[% ELSE %]    
    [% INCLUDE 'reports/new/some_councils_text.html' %]
[% END %]


[% IF skipped %]
    [% loc('Please fill in the form below with details of the problem, and describe the location as precisely as possible in the details box.') %]
[% ELSE %]
    [% INCLUDE 'reports/new/fill_in_details_text.html' %]
[% END %]

<input type="hidden" name="latitude"  value="[% latitude  | html %]">
<input type="hidden" name="longitude" value="[% longitude | html %]">

[% FOREACH error IN errors %]
    [% '<ul class="error">' IF loop.first %]
    <li>[% error %]</li>
    [% '</ul>' IF loop.last %]
[% END %]

<div id="problem_form">

[% INCLUDE 'reports/new/form_heading.html' %]

<div id="fieldset">





[% IF field_errors.council %]
    <div class='form-error'>[% field_errors.council %]</div>
[% END %]

[% IF category_options.size %]
    [% IF field_errors.category %]
        <div class='form-error'>[% field_errors.category %]</div>
    [% END %]
    
    <div class="form-field">
        <label for="category">[% category_label | html %]</label>
        <select name="category">
            [%- FOREACH cat_op IN category_options %]
            <option value="[% cat_op | html %]"[% ' selected' IF report.category == cat_op %]>[% cat_op | html %]</option>
            [%- END %]
        </select>
    </div>
[% END %]

[% IF field_errors.title %]
    <div class='form-error'>[% field_errors.title %]</div>
[% END %]

<div class="form-field">
    <label for="form_title">[% loc('Subject:') %]</label>
    <input type="text" value="[% report.title | html %]" name="title" id="form_title" size="25">
</div>

[% IF field_errors.detail %]
    <div class='form-error'>[% field_errors.detail %]</div>
[% END %]

<div class="form-field">
    <label for="form_detail">[% loc('Details:') %]</label>
    <textarea name="detail" id="form_detail" rows="7" cols="26">[% report.detail | html %]</textarea>
</div>

[% IF field_errors.photo %]
    <div class='form-error'>[% field_errors.photo %]</div>
[% END %]

[% IF upload_fileid || report.photo %]
    <p>[% loc('You have already attached a photo to this report, attaching another one will replace it.') %]</p>
    <input type="hidden" name="upload_fileid" value="[% upload_fileid %]" />
[% END %]

<div class='form-field'>
    <label for="form_name">[% loc('Photo:') %]</label>
    <input type="file" value="" name="photo" id="form_photo" >
</div>


[% IF field_errors.name %]
    <div class='form-error'>[% field_errors.name %]</div>
[% END %]

<div class='form-field'>
    <label for="form_name">[% loc('Name:') %]</label>
    <input type="text" value="[% report_user.name | html %]" name="name" id="form_name" size="25">
</div>


<div class="checkbox">

    [%# if there is nothing in the name field then set check box as default on form %]
    <input type="checkbox" name="may_show_name" id="form_may_show_name" value="1"[% ' checked' IF !report.anonymous || !report.name %]>

    <!-- FIXME - empythomes should be 'Can we show your name on the site?'-->
    <label for="form_may_show_name">[% loc('Can we show your name publicly?') %]</label>
    <small>[% loc('(we never show your email address or phone number)') %]</small>
</div>

[% IF field_errors.email %]
    <div class='form-error'>[% field_errors.email %]</div>
[% END %]

<div class="form-field">
    <label for="form_email">[% loc('Email:') %]</label>
    <input type="text" value="[% report_user.email | html %]" name="email" id="form_email" size="25">
</div>

<div>
    <label for="form_phone">[% loc('Phone:') %]</label>
    <input type="text" value="[% report_user.phone | html %]" name="phone" id="form_phone" size="15">
    <small>[% loc('(optional)') %]</small>
</div>

[% INCLUDE 'reports/new/notes.html' %]

[% IF partial_token %]
    <input type="hidden" name="partial" value="[% partial_token.token %]">
[% END %]

<p id="problem_submit">
    <input type="hidden" name="submit_problem" value="1">
    <input type="submit" value="[% loc('Submit') %]">
</p>

</div>
</div>

[% map_end %]

[% INCLUDE 'footer.html' %]