[% INCLUDE 'admin/header.html' title=loc('Search Users') %]
[% PROCESS 'admin/report_blocks.html' %]

<div class="fms-admin-info">
    [% loc("User search finds matches in users' names and email addresses.") %]
</div>

<form method="get" action="[% c.uri_for_action('admin/users/index') %]" enctype="application/x-www-form-urlencoded" accept-charset="utf-8">
<div class="filters">

    <p><label for="search">[% loc('Search:') %]</label>
        <input class="form-control" type="text" name="search"  size="30" id="search" value="[% searched | html %]">
  [% IF roles %]
    <p><label for="role">[% loc('Role:') %]</label>
    <select name="role" id="role" class="form-control">
        <option value="">---</option>
      [% FOR role IN roles %]
          [% IF c.user.is_superuser AND last_name != role.body.name %]
            <optgroup label="[% role.body.name %]">
            [% SET last_name = role.body.name %]
          [% END %]
        <option value="[% role.id %]"[% ' selected' IF role.id == role_selected %]>[% role.name | html %]</option>
      [% END %]
    </select>
  [% END %]
    <p class="no-label"><input type="submit" value="[% loc('Go') %]" class="btn">

</div>
</form>

[% IF users.size %]

<table cellspacing="0" cellpadding="2" border="1">
    <tr>
        <th>[% loc('Name') %]</th>
        <th>[% loc('Email') %]</th>
        <th>[% loc('Body') %]</th>
      [% IF c.cobrand.moniker != 'zurich' %]
        <th>[% loc('Flagged') %]</th>
      [% END %]
        <th>*</th>
    </tr>
[%- FOREACH user IN users %]
    <tr>
        <td>[% PROCESS value_or_nbsp value=user.name %]</td> 
        <td><a href="[% c.uri_for_action( 'admin/reports', search => user.email ) %]">[% PROCESS value_or_nbsp value=user.email %]</a></td> 
        <td>[% PROCESS value_or_nbsp value=user.from_body.name %]
            [% IF user.is_superuser %] * [% END %]
        </td>
      [% IF c.cobrand.moniker != 'zurich' %]
        <td>[% user.flagged == 2 ? loc('User in abuse table') : user.flagged ? loc('Yes') : '&nbsp;' %]</td>
      [% END %]
        <td>[% IF user.id %]<a href="[% c.uri_for_action( 'admin/users/edit', user.id ) %]">[% loc('Edit') %]</a>[% END %]</td>
    </tr>
[%- END -%]
</table>

[% ELSIF searched || role_selected %]

<div class="fms-admin-warning">
    [% loc("Searching found no users.") %]
</div>

[% END %]

[% IF NOT searched %]
<h2>[% loc('Add user') %]</h2>
[% INCLUDE 'admin/users/form.html', user = '' %]
[% ELSE %]
<a href="[% c.uri_for_action('admin/users/add') %]">[% loc('Add user') %]</a>
[% END %]

[% INCLUDE 'admin/footer.html' %]
