[%~ IF NOT select_name %]
    [%~ select_name = 'category' %]
[%~ END %]
[%~ BLOCK category_option ~%]
<option value="[% cat.category | html %]"[% ' selected' IF problem.category == cat.category %]>[% cat.category_display | html %]</option>
[%~ END ~%]

<select class="form-control" name="[% select_name %]" id="[% select_name %]">
  [% IF NOT problem.category OR NOT categories_hash.${problem.category} %]
    <optgroup label="[% loc('Existing category') %]">
        <option selected value="[% problem.category | html %]">[% (problem.category_display OR '-') | html %]</option>
    </optgroup>
  [% END %]
  [% IF category_groups.size OR category_options.size %]
    [%~ IF category_groups.size ~%]
      [%~ FOREACH group IN category_groups ~%]
        [% IF group.name %]<optgroup label="[% group.name %]">[% END %]
          [%~ FOREACH cat IN group.categories ~%]
            [% INCLUDE category_option %]
          [%~ END ~%]
        [% IF group.name %]</optgroup>[% END %]
      [%~ END =%]
    [%~ ELSE ~%]
      [%~ FOREACH cat IN category_options ~%]
        [% INCLUDE category_option %]
      [%~ END =%]
    [%~ END ~%]
  [% END %]
</select>
