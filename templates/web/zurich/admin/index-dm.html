[% INCLUDE 'admin/header.html' title=loc('Summary') -%]
[% PROCESS 'admin/report_blocks.html' %]
[%
    states = {
        'unconfirmed' = loc('Submitted'),
        'confirmed' = loc('Open'),
        'in progress' = loc('In progress'),
        'fixed - council' = loc('Fixed'),
        'hidden' = loc('Hidden'),
        'closed' = loc('Third party'),
    }
%]

<h2>New reports</h2>
[% INCLUDE list, problems = unconfirmed.all %]

<h2>Updates needing attention</h2>
<table cellspacing="0" cellpadding="2" border="1">
    <tr>
        <th>[% loc('ID') %]</th>
        <th>[% loc('Problem ID') %]</th>
        <th>[% loc('Category') %]</th>
        <th>[% loc('Text') %]</th>
        <th>[% loc('Created') %]</th>
        <th>*</th>
    </tr>
[%- FOR update IN approval.all %]
    <tr[% ' class="adminhidden"' IF problem.state == 'hidden' %]>
        <td>[% update.id %]</td>
        <td>[% update.problem.id %]</td>
        <td>[% update.problem.category %]</td>
        <td>[% update.text %]</td>
        <td>[% PROCESS format_time time=update.created %]</td>
        <td><a href="[% c.uri_for( 'update_edit', update.id ) %]">[% loc('Edit') %]</a></td>
    </tr>
[%- END -%]
</table>

<h2>All reports</h2>
[% INCLUDE list, problems = other.all %]

[% INCLUDE 'admin/footer.html' %]

[% BLOCK list %]
<table cellspacing="0" cellpadding="2" border="1">
    <tr>
        <th>[% loc('ID') %]</th>
        <th>[% loc('Title') %]</th>
        <th>[% loc('Status') %]</th>
        <th>[% loc('Category') %]</th>
        <th>[% loc('Created') %]</th>
        <th>*</th>
    </tr>
[%- FOR problem IN problems %]
    <tr[% ' class="adminhidden"' IF problem.state == 'hidden' %]>
        <td>[% problem.id %]</td>
        <td>[% PROCESS value_or_nbsp value=problem.title %]</td>
    [% FOREACH state IN [ ['confirmed', loc('Open')], ['investigating',
    loc('Investigating')], ['planned', loc('Planned')], ['in progress',
    loc('In progress')], ['closed', loc('Closed')], ['fixed', loc('Fixed')], ['fixed - user',
    loc('Fixed - User')], ['fixed - council', loc('Fixed - Council')], ['hidden', loc('Hidden')], ['partial', loc('Partial')],['unconfirmed',loc('Unconfirmed')] ] %]
        <option [% 'selected ' IF state.0 == problem.state %] value="[% state.0 %]">[% state.1 %]</option>
    [% END %]
        <td>[% states.${problem.state} %]</td>
        <td>[% problem.category %]</td>
        <td>[% PROCESS format_time time=problem.created %]</td>
        <td><a href="[% c.uri_for( 'report_edit', problem.id ) %]">[% loc('Edit') %]</a></td>
    </tr>
[%- END -%]
</table>
[% END %]
