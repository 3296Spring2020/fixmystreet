[%- FOR problem IN problems %]
    [% SET p_body = problem.bodies.values.0 %]
    [% IF page == 'search' %]
        [% NEXT IF admin_type == 'sdm' AND p_body.id != body.id %]
        [% NEXT IF admin_type == 'dm' AND p_body.id != body.id AND p_body.parent.id != body.id %]
    [% END %]
    <tr[%
        SET classes = [];
        classes.push('adminhidden') IF problem.state == 'hidden';
        classes.push('overdue') IF c.cobrand.overdue( problem );
        classes.push('row-link') IF NOT no_edit;
        ' class="' _ classes.join(' ') _ '"' IF classes.size;
    %]>
        <td class="record-id">
          [% IF no_edit AND problem.is_visible %]
            <a href="[% c.uri_for_email( '/report', problem.id ) %]">[% problem.id %]</a>
          [% ELSIF no_edit %]
            [% problem.id %]
          [% ELSE %]
            <a href="[% c.uri_for( 'report_edit', problem.id ) %]">[% problem.id %]</a>
          [% END %]
        </td>
        <td>[% PROCESS value_or_nbsp value=problem.title %]</td>
        <td>[% PROCESS value_or_nbsp value=problem.category %]</td>
        <td>[% PROCESS format_date this_date=problem.created %]</td>
        <td>[% PROCESS format_date this_date=problem.lastupdate %]</td>
        <td>[% states.${problem.state} %]</td>

        [% IF include_subdiv %]
            <td>
                [%- IF p_body.parent.parent.id -%][%# ...it's a subdivision %]
                    [% PROCESS value_or_nbsp value=p_body.name %]
                [%- ELSIF problem.external_body %]
                    [% PROCESS value_or_nbsp value=problem.body(c).name %]
                [%- ELSE -%]
                    &nbsp;
                [%- END -%]
            </td>
        [% END %]

        [% IF NOT no_edit %]
            <td><a href="[% c.uri_for( 'report_edit', problem.id ) %]">[% loc('Edit') %]</a></td>
        [% END %]
    </tr>
[%- END -%]
